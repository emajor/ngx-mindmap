!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("@angular/core"),require("cytoscape"),require("cytoscape-context-menus"),require("cytoscape-popper"),require("@angular/forms"),require("ngx-color-picker"),require("jquery"),require("ngx-bootstrap/utils"),require("ngx-bootstrap/modal"),require("@angular/common")):"function"==typeof define&&define.amd?define("mindmap",["exports","@angular/core","cytoscape","cytoscape-context-menus","cytoscape-popper","@angular/forms","ngx-color-picker","jquery","ngx-bootstrap/utils","ngx-bootstrap/modal","@angular/common"],o):o((e=e||self).mindmap={},e.ng.core,e.cytoscape,e.contextMenus,e.popper,e.ng.forms,e.ngxColorPicker,e.$,e.utils,e.modal,e.ng.common)}(this,(function(e,o,t,n,r,a,i,d,l,c,s){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,d=d&&d.hasOwnProperty("default")?d.default:d;function u(e){var o="function"==typeof Symbol&&e[Symbol.iterator],t=0;return o?o.call(e):{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}}var p=function(){function e(){}return e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),m=function(){function e(){}return e.prototype.getRandomColor=function(){for(var e="#",o=0;o<6;o++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},e.prototype.checkedColor=function(e){var o=this.getRandomColor();return e.includes(o)&&this.checkedColor(e),o},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),f=function(){function e(){}return e.prototype.removeToolbarNode=function(e){var o=e.data("id"),t=document.querySelector("#toolbar-"+o);t&&t.remove()},e.prototype.hideToolbarNode=function(e){var o=e.data("id"),t=document.querySelector("#toolbar-"+o);t&&(t.style.visibility="hidden")},e.prototype.showToolbarNode=function(e){var o=e.data("id"),t=document.querySelector("#toolbar-"+o);t&&(t.style.visibility="visible")},e.prototype.collapseNode=function(e){var o=this;e.data("collapsed",!0);var t=e.connectedEdges('[source="'+e.data("id")+'"]');t.length&&t.map((function(e){"visible"===e.style("visibility")&&(e.style("visibility","hidden"),e.target().map((function(e){e.style("visibility","hidden"),e.data("show",!1),o.hideToolbarNode(e),o.collapseNode(e)})))}))},e.prototype.expandNode=function(e){var o=this,t=e.connectedEdges('[source="'+e.data("id")+'"]');e.data("collapsed",!1),t.length&&t.map((function(e){"hidden"===e.style("visibility")&&(e.style("visibility","visible"),e.target().map((function(e){e.style("visibility","visible"),e.data("show",!0),o.showToolbarNode(e),o.expandNode(e)})))})),this.hideToolbarNode(e)},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),h=function(){function e(e){this.colorService=e,e=this.colorService}return e.prototype.getNodeById=function(e,o){return o.cy.nodes('[id="'+e+'"]')},e.prototype.renameNode=function(e,o){var t=e.data("label"),n=prompt("Quel nom pour ce noeud ?",t);n!==t&&e.data("label",n),o.emitChange()},e.prototype.getUniqueNodeId=function(e){var o=e.cy.nodes().map((function(e){return e.data("id")})),t=Math.round(1e5*Math.random()).toString(10);return-1!==o.indexOf(t)?this.getUniqueNodeId(e):t},e.prototype.getLastNodeId=function(e){e.cy.nodes()},e.prototype.getParentNode=function(e,o){var t=e.data("id"),n=e.connectedEdges('[target="'+t+'"]').data("source");return o.cy.nodes('[id="'+n+'"]')},e.prototype.updateInformationNode=function(e,o){e.data("label",o.formNode.value.name),e.style("background-color",o.formNode.value.color),this.updateColorBranchNode(e,o.formNode.value.color,o)},e.prototype.merge_array=function(e,o){for(var t=[],n=e.concat(o),r=n.length,a={};r--;){var i=n[r];a[i]||(t.unshift(i),a[i]=!0)}return t},e.prototype.getBranchConnected=function(e,o,t,n){var r=[],a=[],i=e.data("id");if(r=this.merge_array(r,o),a=this.merge_array(t,a),"n"!==i){a.push(i);var d=this.getNodeConnected(this.getNodeById(i,n));if(r=this.merge_array(r,d),d.length>0)for(var l in d)if("n"!==(l=d[l])&&!a.includes(l)){r.push(l),a.push(l);var c=this.getBranchConnected(this.getNodeById(l,n),r,a,n);r=this.merge_array(r,c)}}return r},e.prototype.getNodeConnected=function(e){var o,t=e.data("id"),n=[],r=e.connectedEdges();if(delete r._private,delete r.length,(o=Object.values(r)).length>0&&!n.includes(t))for(var a in o){var i=o[a].data("target"),d=o[a].data("source");"n"===i||n.includes(i)||i===t||n.push(i),"n"===d||n.includes(d)||d===t||n.push(d)}return n},e.prototype.openModalUpdateNode=function(e,o){var t=e.data("id");"n"!==t&&(o.statusModal=!0,o.formNode.get("id").setValue(t),o.openModal(),o.formNode.get("name").setValue(e.data("label")),o.color=e.style("background-color"),o.formNode.get("color").setValue(e.style("background-color")))},e.prototype.openModalAddNode=function(e,o){console.log("on atteind la fonction"),o.statusModal=!1,o.formNode.get("id").setValue(e.data("id"));var t=this.colorService.checkedColor(o.arrayColorUsed);"n"!==e.data("id")&&(t=e.style("background-color")),o.color=t,o.formNode.get("color").setValue(t),o.openModal()},e.prototype.updateColorBranchNode=function(e,o,t){var n=this.getBranchConnected(e,[],[],t);for(var r in n)r=n[r],this.getNodeById(r,t).style("background-color",o)},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:m}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(m))},token:e,providedIn:"root"}),e}();var v=function(){function e(){}return e.prototype.isCollapsable=function(e){return 0!==e.connectedEdges('[source="'+e.data("id")+'"]').length},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),g=function(){function e(e,o,t,n){this.nodeService=e,this.toolbarService=o,this.colorService=t,this.collaspeService=n,o=this.toolbarService,e=this.nodeService,t=this.colorService,n=this.collaspeService}return e.prototype.createToolbarNode=function(e,o){var t=this,n=this.nodeService.getNodeById(e,o),r=document.createElement("div");r.style.border="1px solid red",r.id="toolbar-"+e,document.body.appendChild(r);var a=document.createElement("div");a.className="mindmap-toolbar",r.appendChild(a);var i=document.createElement("div");i.id="options",a.appendChild(i);var d=document.createElement("div");d.className="actions",a.appendChild(d);var l=document.createElement("button");if(l.innerHTML="+",l.setAttribute("data-node-id",e),l.onclick=function(e){console.log("on passe ic frerre ");var n=e.target.dataset.nodeId,r=t.nodeService.getNodeById(n,o);t.nodeService.openModalAddNode(r,o)},d.appendChild(l),"n"!==e){var c=document.createElement("button");c.innerHTML="x",c.onclick=function(){t.removeNode(n,o)},d.appendChild(c)}if(this.collaspeService.isCollapsable(n)&&!n.data("collapsed")){var s=document.createElement("button");s.innerHTML="_",s.onclick=function(){t.toolbarService.collapseNode(n),t.refreshToolbarNode(n,o)},d.appendChild(s)}if(n.data("collapsed")){var u=document.createElement("button");u.innerHTML="E",u.onclick=function(){t.toolbarService.expandNode(n),t.refreshToolbarNode(n,o)},d.appendChild(u)}return r},e.prototype.addToolbarNode=function(e,o){var t=this,n=o.cy.nodes('[id="'+e+'"]'),r=n.popper({content:function(){return t.createToolbarNode(e,o)}}),a=function(){r.scheduleUpdate()};n.on("position",a),o.cy.on("pan zoom resize",a)},e.prototype.refreshToolbarNode=function(e,o){this.toolbarService.removeToolbarNode(e),this.addToolbarNode(e.data("id"),o)},e.prototype.addChildNode=function(e,o,t,n){void 0===e&&(e=null),!0===e.data("collapsed")&&this.toolbarService.expandNode(e);var r=e.data("id"),a=this.nodeService.getUniqueNodeId(n),i=n.cy.add({group:"nodes",data:{id:a,label:o,collapsed:!1}});i.style("background-color",t);var d=r+"-"+a;n.cy.add({group:"edges",data:{id:d,source:r,target:a}}),e.data("collapsed",!1),this.addToolbarNode(a,n),this.nodeService.updateColorBranchNode(i,t,n),this.refreshToolbarNode(e,n),this.toolbarService.hideToolbarNode(i),n.renderGraph(),n.emitChange()},e.prototype.removeNode=function(e,o){var t,n,r=e.data("id");if("n"!==r){var a=o.cy.edges('[source="'+r+'"]'),i=Object.keys(a),l=this.nodeService.getParentNode(e,o);console.log("PARENT",l.data()),this.refreshToolbarNode(l,o);try{for(var c=u(i),s=c.next();!s.done;s=c.next()){var p=s.value,m=a[p];m._private&&(m=a[p]._private.target,d("#button"+r).remove(),this.removeNode(m,o),o.cy.remove(m)),d("#toolbar-"+r).remove(),o.cy.remove(e)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}this.toolbarService.removeToolbarNode(e),o.emitChange()},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:h},{type:f},{type:m},{type:v}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(h),o.ɵɵinject(f),o.ɵɵinject(m),o.ɵɵinject(v))},token:e,providedIn:"root"}),e}();l.setTheme("bs4"),t.use(r),t.use(n,d);var A=function(){function e(e,t,n,r,a,i,d,l,c){this.formBuilder=e,this.cpService=t,this.toolbarService=n,this.colorService=r,this.nodeService=a,this.mutualService=i,this.el=d,this.renderer=l,this.modalService=c,this.onChange=new o.EventEmitter,this.arrayColorUsed=["#000000"],this.timestampLastClick=0,this.loading=!1,this.submitted=!1,this.elements={nodes:[{data:{id:"n",label:"Root"}}]},this.cy=null,this.config={container:null,elements:this.elements,layout:{name:"cose"},maxZoom:2.5,minZoom:.5,style:[{selector:"node",style:{label:"data(id)",shape:"round-rectangle","background-color":"#000000"}},{selector:"edge",style:{"line-color":"#EEE"}}]},t=this.cpService,n=this.toolbarService,r=this.colorService,a=this.nodeService,i=this.mutualService}return e.prototype.eventChangeColor=function(e,o){this.formNode.get("color").setValue(o)},e.prototype.ngOnInit=function(){var e=this,o=this;this.config.container=this.el.nativeElement.firstElementChild,this.cy=t(this.config),this.cy.on("tap","node",(function(e){var o=e.timeStamp;o-this.timestampLastClick<500&&e.target.trigger("doubletap",e),this.timestampLastClick=o})),this.cy.on("doubletap",(function(e,t){console.log("evenement",e),o.nodeService.openModalUpdateNode(e.target,o)})),this.cy.on("mouseout","node",(function(e){var t=e.target;o.toolbarService.hideToolbarNode(t)})),this.cy.on("mouseover","node",(function(e){var t=e.target;o.toolbarService.showToolbarNode(t)}));var n={menuItems:[{id:"add-node",content:"Ajouter un noeud enfant",selector:"node",onClickFunction:function(t){var n=t.target;e.nodeService.openModalAddNode(n,o)}},{id:"rename-node",content:"Modifier",selector:"node",onClickFunction:function(o){var t=o.target;e.nodeService.openModalUpdateNode(t,e)}},{id:"collapse-node",content:"Replier",selector:"node",onClickFunction:function(o){var t=o.target;e.collapseNode(t)}},{id:"expand-node",content:"Déplier",selector:"node",onClickFunction:function(o){var t=o.target;e.expandNode(t)}},{id:"remove-node",content:"Supprimer",selector:'node[id!="n"]',onClickFunction:function(o){var t=o.target;e.mutualService.removeNode(t,e)}}]};this.optionMenu=this.cy.contextMenus(n),this.optionMenu.isActive(),this.mutualService.addToolbarNode("n",this),this.cy.on("cxttapstart","node",(function(e){var t=e.target;console.warn(t),!t.data("collapsed")&&o.nodeService.getNodeConnected(t).length>0&&(o.optionMenu.hideMenuItem("expand-node"),o.optionMenu.showMenuItem("collapse-node")),t.data("collapsed")&&(o.optionMenu.hideMenuItem("collapse-node"),o.optionMenu.showMenuItem("expand-node")),t.data("collapsed")||0!==o.nodeService.getNodeConnected(t).length||(o.optionMenu.hideMenuItem("expand-node"),o.optionMenu.hideMenuItem("collapse-node")),o.mutualService.refreshToolbarNode(t,o)})),this.formNode=new a.FormGroup({id:new a.FormControl(null),name:new a.FormControl("Nouveau node",[a.Validators.required,a.Validators.maxLength(40)]),color:new a.FormControl(this.colorService.checkedColor(o.arrayColorUsed),[a.Validators.required,function(e){var t=e.value;return o.arrayColorUsed.includes(t)?{validateColor:{valid:!1}}:null}])})},Object.defineProperty(e.prototype,"f",{get:function(){return this.formNode.controls},enumerable:!0,configurable:!0}),e.prototype.openModal=function(){this.modalRef=this.modalService.show(this.modalNode)},e.prototype.closeModal=function(){this.modalRef.hide()},e.prototype.onSubmit=function(){if(this.submitted=!0,!this.formNode.invalid){this.loading=!0;var e=this.formNode.value.id,o=this.nodeService.getNodeById(e,this);this.statusModal?this.nodeService.updateInformationNode(o,this):this.mutualService.addChildNode(o,this.formNode.value.name,this.formNode.value.color,this),this.submitted=!1,this.loading=!1,this.formNode.reset(),this.closeModal(),this.formNode.get("name").setValue("NOuveau node")}},e.prototype.renderGraph=function(){this.cy.layout({name:"cose"}).run()},e.prototype.emitChange=function(){this.onChange.emit(this.cy.json())},e.prototype.collapseNode=function(e){return this.toolbarService.collapseNode(e)},e.prototype.expandNode=function(e){return this.toolbarService.expandNode(e)},e.decorators=[{type:o.Component,args:[{selector:"lib-mindmap",template:'<div class="mindmap"></div>\n\n\x3c!-- Modal edition/ajout d\'un node  --\x3e\n<ng-template #modalNode>\n\n  <div class="modal-header">\n    <h5 *ngIf="!statusModal" class="modal-title" id="title">Ajouter un node</h5>\n    <h5 *ngIf="statusModal" class="modal-title" id="title">Modification d\'un node</h5>\n    <button type="button" (click)="modalRef.hide()" class="close" data-dismiss="modal" aria-label="Close">\n      <span aria-hidden="true">&times;</span>\n    </button>\n  </div>\n\n  <div class="modal-body">\n    <form [formGroup]="formNode" (ngSubmit)="onSubmit()">\n      <div class="form-group">\n        <label for="name">Nom</label>\n        <input id="name" type="text" formControlName="name" class="form-control"\n          [ngClass]="{ \'is-invalid\': submitted && f.name.errors }">\n        <div *ngIf="submitted && f.name.errors" class="invalid-feedback">\n          <div *ngIf="f.name.errors.required">Le nom est requis</div>\n        </div>\n      </div>\n\n      <div class="form-group">\n        <label for="color">Couleur</label>\n        <input id="color" [value]="color" [(colorPicker)]="color"\n          (colorPickerClose)="eventChangeColor(\'colorPickerClose\', $event)" [cpToggle]="true"\n          [cpDialogDisplay]="\'popup\'" [style.background]="color" formControlName="color" class="form-control"\n          [ngClass]="{ \'is-invalid\': submitted && f.color.errors }">\n        <div *ngIf="submitted && f.color.errors" class="invalid-feedback">\n          <div *ngIf="f.color.errors.required">La couleur est requise</div>\n          <div *ngIf="f.color.errors.validateColor">La couleur est déjà utilisée</div>\n        </div>\n      </div>\n\n      <div class="modal-footer">\n        <div class="form-group">\n          <button *ngIf="!statusModal" [disabled]="loading" type="submit" class="btn btn-primary">Ajouter</button>\n          <button *ngIf="statusModal" [disabled]="loading" type="submit" class="btn btn-primary">Modifier</button>\n          <img *ngIf="loading" class="pl-3"\n            src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />\n          <button type="button" (click)="modalRef.hide()" class="btn btn-secondary"\n            data-dismiss="modal">Annuler</button> </div>\n      </div>\n\n    </form>\n  </div>\n</ng-template>',styles:[".mindmap{height:600px;float:left;position:relative;border:solid #21c0c0;width:1000px}#toolbar-n{border:10px solid green!important}"]}]}],e.ctorParameters=function(){return[{type:a.FormBuilder},{type:i.ColorPickerService},{type:f},{type:m},{type:h},{type:g},{type:o.ElementRef},{type:o.Renderer2},{type:c.BsModalService}]},e.propDecorators={onChange:[{type:o.Output}],modalNode:[{type:o.ViewChild,args:["modalNode",{static:!0}]}]},e}();var y=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{declarations:[A],imports:[s.CommonModule,a.ReactiveFormsModule,a.FormsModule,i.ColorPickerModule,c.ModalModule.forRoot()],providers:[f,m,g,v,h],bootstrap:[A],exports:[A]}]}],e}();e.MindmapComponent=A,e.MindmapModule=y,e.MindmapService=p,e.ɵa=f,e.ɵb=m,e.ɵc=h,e.ɵd=g,e.ɵe=v,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=mindmap.umd.min.js.map